всем привет примерно 20 дней назад я выпустил первое видео по теме playwright с названием что

это самосовременное селениум но это в принципе чистая правда данное видео вам понравилось судя

по количеству комментариев количество просмотров несмотря на то что мой канал очень маленький

Комментарий он собрал довольно много.

И все комментарии сводятся к одному, что вы хотите видеть более подробно,

как эта библиотека себя проявляет в деле по сравнению с Selenium,

и как делать на ней какие-то простые вещи.

К основным вещам, которые хотелось бы показать,

которые постоянно используются в парсинге или автоматизации действий в интернете,

это поиск элемента, работа с несколькими элементами, ожидания, клик,

вот каких-то данных мы будем смотреть по ходу дела и так давайте приступим на чем в начнем

примере мы будем это все показывать естественно из названия вы знаете что это будет сайт озон

не смотрите что это озон by озонру ничем не отличается что хотелось бы здесь сделать но

во-первых открыть сам сайт далее ввести вентиляторы или любое другое слово так как

лето и жарко посмотреть вентиляторы и открыть первое ну допустим 55 элементов и узнать как

называется продавец действие довольно несложное но позволит нам посмотреть как это все делать в

playwright будет очень интересно поэтому я думаю поехали итак открываем документацию playwright

раздел установка копируем п пин стол по и тест playwright вставляем в терминал в вашей любимой

и дем и все установится обратите внимание что устанавливается именно пай тест playwright

пай тест это библиотека для тестирования наверно одна из самых популярных библиотек для тестирования

с множеством возможностей и такие библиотеки вообще как playwright селением и прочее создавались

в первую очередь для тестирования можно сказать что мы используем данные инструменты не совсем

по назначению по прямому назначению но тем не менее кто нам запретит это делать на данном канале

выкладываться ролики в первую очередь по парсингу и автоматизацию данных в интернете не тестированием

хотя это и близкие штуки вторая команда будет playwright install данная команда установит браузера

который будет необходимы для дальнейшей работы если вы какой-то создавали проект на playwright

и качали эти браузеры вам все равно нужно данную команду запускать но не переживайте playwright

умная библиотека она сама поймет что данные браузер установлены и просто подправить какие-то

у себя данные что-то вроде того и так данное действие я уже провел поэтому приступаем коду

документация у меня будет под рукой потому что я не так много проектов написал на

playwright и могу иногда подсматривать давайте начнем

начинаем мы с импорта будем работать с синхронной версии в первый раз не будем

заморачиваться с асинхронностью и так мы импорт 0 sing playwright ну и будем по стандарту писать

какие-то все в виде класса давайте назовем класс озон seller прощения seller парс по моему отличное

название которое сразу понятно что что он будет делать создадим инициализатор класса давайте

подумаем что нам необходимо передавать в данный класс по сути у нас будут мы передаем какое-то

слово которое будет составляться в поисковую строку нажимать центр и на выходе мы хотим

получать список продавцов там примеру топ-5 продавцов по данному слову как-то так то есть

там по идее нужен какой-то keyword то есть одно слово к примеру вентилятор

но и это будет строка сел в keyword

равно keyboard и давайте наверное заведем здесь с верный список с именами будет пустой потом где-то

будем их добавлять наверное так далее нам необходимо создать какой-то метод который

мы будем вызывать извне давайте назовем его да в парс и вызовем с помощью контекстного менеджера

синтаро это с плейрой обращаю ваше внимание что плейрой это здесь не обязательно то есть данная

переменная это как мы назовем так она и пойдет очень удобно пользоваться контекстным менеджером

в том плане в том что мы не будем заботиться о том закроется ли браузер в конце работы если все

происходит в контекстном менеджере который начинается свой значит все будет прекрасно

все закроется само и так нам необходимо создать сам браузер в данном видео я

наверное буду часто приводить параллели с селением потому как это наверное

основной рабочий инструмент в данный момент в селении делается подобие

селением. веб-драйвера. chrome как-то так но здесь очень похожи

пларает хроме муанч и здесь можем перед передать параметры headless falls потому что по умолчанию

он будет запускаться в ходе с режиме то есть без головом мы не будем видеть графический интерфейс

нам это сейчас совсем не важно точнее не нужно там хотелось бы все видеть весь процесс далее

очень интересная штука в пленать контекст давайте напишу сначала потом постараюсь объяснить что это

такое несмотря на то что это делается в одну строку эта штука довольно таки важная и важно

правильно понять что она делает и как ей пользоваться вообще что такое контекст допустим у вас есть

основной браузер chrome в котором вы сидите вы там зарегистрированы на gmaili mail и в к яндексе и

прочее открываете вкладку новую вводите примеру яндекс и сразу подхватывается ваш пароль вводите

озон сразу подхватывается ну то есть сразу видно что вы зашли в свой аккаунт хоть вы ничего сейчас

не вводили. Потому как у вас есть куки, у вас есть кэш и прочее прочее. То есть, сколько бы вкладок

не открывали, каждая вкладка имеет доступ к этому всему. Но если вы открываете тот же браузер в

режиме инкогнито, у вас вкладки теряют доступ к этим кукам. И если вы ведете, к примеру,

Яндекс.ру или Озон.ру, там будет новый профиль.

Ну, вообще не будет профиля на самом деле.

Вы можете зарегистрироваться или войти прямо там,

и тогда на других вкладках вы тоже будете иметь доступ.

Как только вы закрываете инкогнито,

все куки автоматически удаляются.

Вот именно контекст это и есть то самое.

То есть в одном контексте хранятся все куки, весь кэш и прочее.

Таких контекстов вы можете создавать несколько.

и это очень удобно то есть каждый контекст будет отдельно в каждом контексте будет что-то свое

надеюсь это понятно поехали дальше создадим новую страницу она создается как раз таки

контексте дальше self-page переходим по адресу тут принципе ничего ничего нового озон

давайте исправлю нору так наверное вам будет привычнее но он меня все равно когда будет

запускаться скорее всего справит на бай азон по и печеньку смотрит где нахожусь далее нам надо

найти нам надо найти поле с поиском давайте перезагрузим страницу откроем инструменты

разработчика и посмотрим данный элемент этот элемент input у него есть placeholder есть куча

различных атрибутов по которым мы можем на него выйти в плейрати есть очень удобная автоматическая

заготовка искать по placeholder и причем если вы будете пользоваться генератором тестов он по

если есть placeholder он будет искать по нему давайте так же сделаем get да как видите вот

почему мы можем сказать placeholder атрибут текст роль лойду alt текст кстати наверное какие-то новые

появились я даже не все сам знаю и так текст у нас будет искать на озон далее нам необходимо отлично

сразу подсказывает type аналог сент кейс в селениум то есть что нам написать текст равно но и текст

напомню у нас это кейворд который нам приходит в класс ссылки и word очень классная штука в есть

плейрайте называется давай то есть задержка пусть будет 03 в чем смысл если в том же селением я

написать sand case и какое-то слово она будет такое чувство что сделала control c control в то есть

ставит моментально и некоторые сайты это палят и палят поэтому ботов но что люди так не делают

если вы пишете вентилятор или видеокарта что такое вы постепенно это делать то есть не так быстро в

селением я писал сам такие вспомогательные методы которые разбивали слова по буквам вводили одну

буквы делали какую-то случайно паузу владели следующую букву и так далее здесь же есть все

из коробки есть давай 0 3 но он всегда делает то есть 0 3 секунды паузу между каждой буквой ввели

текст далее нам необходимо найти найти элемент по которому кликнуть вот этот синенький значок

но не обязательно span вот у нас есть батон батон и у него есть type submit из real i был то есть

можно искать по любым принципе по атрибутам по что это такое батон а по классам айдиш ником и прочим

прочим давайте будем иногда использовать разные все-таки способы чтобы как-то понять есть такое

кори селектор то есть это аналог find by css selector ну и здесь синтаксис очень простой и

понятно во первых что мы ищем мы ищем батон вот на полу батон могли искать бадив спан или что-то

еще данный момент ищем батон открываем квадратные скобки далее пишем какой-то атрибут который мы

знаем type 3 submit с таким же успехом мы могли бы написать что релой был равно поиск style

чему-то там равно как-то так там здесь хотя бы понятно единственный нюанс с кавычками то есть

если здесь двойные значит здесь одинарные либо наоборот если здесь одинарные значит здесь двойные

потому как бывает люди путаются и так с помощью self page кори селектор мы нашли данный элемент

и кликаем по нему давайте наверное запустим данный код напишем стандартную конструкцию

if name равно main чтобы скрипт запустился отсюда вызовем класс озон селер парс передать им туда

keyword вентилятор как мы хотели и вызовем метод парс лично давайте наверно добавим

паузу небольшую в конце чтобы браузер сразу не закрылся запускаем смотрим вело

ползу ползу надо не здесь ставить здесь

да все отлично открывается супер сделаем то же самое здесь

открылся озон теперь обратите внимание мы будем брать дом достаточно нам просто

первых пять позиций но здесь неспроста я показываю на примере озон есть у него очень

интересная особенность давайте скопируем всю данную ссылку откроем постман с помощью которого

мы можем отправлять запросы вставим на нас ссылку и нажмем send посмотрим что нам придет нам пришел

какой-то html нажмем preview вот видим в каком виде с помощью запроса мы можем достать страницу

но смотрим пришел всего два элемента то есть загрузилась остальные все вот в таком вот виде

что это зачем и почему давайте смотреть вот примеру тот элемент который явно не загрузился

и можете обратить внимание что у него есть атрибут loading лойзи и приоритет низкий а это значит все

на всего данный элемент не загрузится пока пользователю то есть мы не обратим на него

внимание то есть пока мы не прогортаем страницу до него он не загрузится если будет грузиться у него

будет приоритет низкий то есть что-то другое будет в приоритете повыше зачем это сделано но на самом

деле это сделано не не для того чтобы нам усложнить жизнь хотя может и здесь есть и такой тоже смысл

на самом деле загрузка страницы особенно такой объемная как у озона то есть посмотрите у каждого

товара есть по три фотографии и на данной странице вот там около 70 по моему товаров представьте

сколько весит вся страница и сколько времени занимает вся ее загрузка умные люди давно посчитали что

что скорость загрузки страницы очень влияет на конверсию, конверсию продаж.

Чем быстрее загружается страница, тем более вероятно,

что пользователь останется на данном сайте,

ну и, соответственно, так как это интернет-магазин, что-то купит.

А теперь представьте, какая посещаемость у Озона

и сколько стоит ему каждая миллисекунда вашего времени.

Ну, поэтому он так и экономит ресурсы.

В нашем случае это есть проблема.

есть на самом деле если мы откроем просто селенью мы увидим здесь два элемента это сразу я говорю

проблема с которой мы столкнемся но ничего все решаемо вот так ввели слово нажали на enter и

открылся у нас результат поиск нам необходимо собрать все ссылки все ссылки на товар китлинкс

чтобы было понятнее то есть нам необходимо просто собрать вот все данные ссылки

давайте смотреть как выглядят данные ссылки то есть по данным классу примеру мы явно на него

не выйдем потому как они скорее всего генерируется как-то автоматически и то есть могут сейчас работать

через пять минут нет и это будет не очень хорошо к чему мы можем вообще зацепиться за что я бы начал

с того что отсеял бы все остальное кроме результатов поисков вот если вы обратите внимание есть какой-то

div у него есть айди пажинатор контент дочерние элементы это все результаты поиска но наверное

имеет смысл дописать что во первых нам нужно дождаться результатов поиска и потом искать

среди них заодно покажу как делается ожидание и так будем ждать элемент self page делается очень

просто wait for selector как видите выпадающий список мы можем ждать на самом деле много чего

и здесь передаем сесса selector так как это айди вот нашу шлек так как это и дешник нам надо

поставить решетку если бы это был класс мы поставили точку но это уже к тому как искать элементы нам

нужно как-то прогротать вниз как это сделать ну на самом деле мы можем нажать кнопку and и страница

автоматически опустится в самый низ но это нам не гарантирует того что здесь что-то загрузится

поэтому такой вариант нам наверное не подойдет хотя может он бы сработал есть другой вариант

мы можем симулировать с помощью java script а движение колесиков колечко мышки вниз и таким

образом пролистать все до конца браузер увидеть что мы как бы обратили внимание и таким образом

должен прогрузить все элементы по идее это должно сработать как это сделать ну давайте для начала

немножко до формы код мы напишем page down давайте напишем страница вниз ну и

пока пока ничего здесь не напишем реализуем это позже а здесь мы это

просто просто напишем также мы в методе парс забыли вызвать get links self

get links еще раз в методе парс мы открываем открываем браузер вводим какой-то кейворд

поисковую строку нажимаем enter далее мы переходим к методу get links метод get links ждет результатов

поиска далее он гортает страницу вниз чтобы все прогрузилась и чтобы вниз все прогрузилась нам

необходимо наверное дождаться чего-то внизу чтобы что-то появилось а что у нас может появиться внизу

к чему мы можем привязаться ну вот смотрите в на данном сайте название классов генерируется

динамически и подвязаться к ним будет непросто как бы класс в общем самом деле невозможно к

такому подвязаться потому как мы не знаем как он будет называться дальше но у нас есть кнопка у

у нее есть текст дальше почему бы нам не подвязаться к ней текст дальше явно не будет меняться

self-page будем ждать селектор если мы знаем текст но на самом деле там есть несколько вариантов но

playwright нам представляет вот такой вариант текст: именно текст не забывайте: и далее пишем что за

текст мы ждем вот таким образом тоже можно писать нам нужно найти все ссылки в данном элементе в

принципе для этого метод этот и и был задуман давайте создадим какой-то промежуточную элемент

назовем результаты поиска все еще result так на самом деле проще искать то есть мы сначала

ищем какой-то один элемент уточняющий то сужаем поле для дальнейшего поиска а потом ищем элементы

у данного уже элемента то есть они у всей страницы но в принципе в селением то же самое можно сделать

какой-то найти элементом или m1 равно find элементом боба было лим 2 равно lm 1. find элемент что-то

там принцип абсолютно тот же и так как нам найти его так это в принципе есть по генетер контейн

далее нам необходимо вот найти все ссылки мы будем искать в результатах поиска и здесь уже

обратите внимание не кори selector а кори selector о аналог fine элемент вселенным то есть мы сразу

не один элемент а несколько давайте смотреть как мы можем их найти кстати полезно комбинация

control shift c позволяет нам делать вот такие вот вещи то есть где мы просто вводим курсором

на что-то наводимся и автоматически справа в инструментах разработчика нам показывает где

мы находимся так вот в принципе ссылка которая нам нужна но и класс у него так тайл хова target

и что-то там еще что-то там еще xh2 вот это нам вряд ли подойдет но тайл хова target выглядит

как будто постоянным таким селектором поэтому давайте наверное найдем данный элемент по ним

так как это класс нам необходимо поставить точку чтобы библиотека поняла почему мы ищем конкретно

давайте выведем print links нет давайте выведем количество лен от links то есть сколько ссылок

он покажет сколько ссылок мы видим я думаю данный вариант подойдет перед тем как сделать я сейчас в

каком-нибудь старом своем проекте за за экраном найду метод java script а который делает гортая

страницу вниз в одном из проектов я нашел java script код как которые делают какой-то java script

прямо на странице он прокручивает колесико мышки до самого конца так как я java script знаю не очень

я даже не помню кто писал данный код вполне возможно что чат gpt может кто-то еще обратите

внимание как вызывается данный метод self page волей в селении уме аналог экзекьют скрипт как-то так

по-моему называется и иногда с помощью него можно делать полезные вещи итак давайте запустим

сайт загрузился

данные внеслись результаты поиска есть как видите вот опускается и 48 загрузила на самом деле можно

было бы подождать конечно загрузки всех повторюсь там по моему около 70 элементов должно быть но

так как мы не собираемся забирать все нам этого будет вполне достаточно мы можем продолжить дальше

итак у нас есть список с всеми нашими ссылками далее нам необходимо пройтись по данному списку

и перейти по каждой ссылке принципе ничего сложного для каждой ссылки в списке ссылок

мы будем вытаскивать url это линк здесь синтаксис что если нам необходимо достать какой-то атрибут

get-атрибут то есть. вселенными атрибут как всегда называется href так и но правда нам

необходимо добавить озон обратите внимание что нам надо добавить озон без наклонной черты в конце

потому как в ссылке в которую мы вытащим она есть вот так так урон мы получили далее что нам

необходимо сделать нам необходимо открыть новую страницу там перейти по адресу и забрать солярный

заодно знаем как открывается новая страница давайте создадим новый метод назовем его get

seller name это уже последний наш метод то есть по идее осталось немного на вход что нам необходимо

нам ну нам только адрес и нужен урул это будет строка пока ничего здесь не реализуем просто

здесь вы вызовем get's learn a и передадим уру уру еще раз у нас есть здесь мы вытаскиваем все

ссылки на все товары которые есть далее для каждой ссылки в этом списке мы точнее здесь все элементы

прошу прощения здесь не ссылки а все элементы содержатся далее мы в каждом элементе проходимся

циклом по данным элементам из каждого элемента достаем атрибуту и череп это как раз наша ссылка

и потом переходим вызываем другу метод который будет делать что другое давайте справим на ru

может будет так работать еще момент мы хотим парсить не все нам необходимо первые пять штук

как нам это сделать первая мысль которая приходит в голову это какой-то завести калом счетчик но

чаще всего так и делать здесь цикл проходится до конца и каждую террацию он увеличивается на

единицу а вначале данного цикла написать и в каунт брейк разорвать данный цикл выйти из

и в принципе данная конструкция будет работать но один два три строки по идее пеп ругается что я тут

видите ли break поставил строку вот так то есть как-то многовато кода для наверно для такого

маленького случая есть вариант проще давайте либо тот каунт и это удалим и это удалим и в

поэт они есть такая замечательная штука и номера it если вот простой список к примеру а б и ц

c если мы будем просто как прогонять цикл for как он и был фолин кин и links у нас будет а b c в

таком же случае с и номер этом у нас и вот здесь еще какую-то переменную нам необходимо так в таком

случае у нас выведет 0 а 1 b 2 c то есть одновременно выводится как элемент так и его

порядковый номер данном списке что бывает крайне удобно вот сейчас как раз тот случай когда очень

удобно и мы можем написать if count больше 5 break по сути одну строку немножко добавили

информации и еще одно внесли но и смотрится это по моему гораздо приятнее плюс в калате в если мы

заведем отдельный счетчик это отдельная какая-то еще переменная которую мы можем забыть где-то

плюсовать то есть могут возникнуть какие-то лишние ошибки которые ну принципе нам совсем не нужны и

так ладно с этим проехали как нам быть с именем солерным давайте откроем вентилятор вот big sale

нам необходимо просто имя как его зовут не ссылка ничего на принципе не нужно нам необходимо открыть

новую страницу это раз давайте сразу наверно так и делать напомню открываемые в контексте

контекст и печь название не написал но единственный нюанс что мы используем self page здесь давайте

наверное все таки и это сделаем self то есть чтобы она относилась именно классу может нам необходимо

будет куда-то и передать мало ли не здесь в page 2 переходим по адресу в галту уру

уру равно уру отлично перешли нам наверно надо проверить как отдает данную страницу если мы

будем использовать запрос давайте тоже проверим как бы здесь по 2 х не вышел у нас пост на не

опять выбираю превью да и как видите подвох здесь тоже есть название продавца он не грузит

то есть здесь нам необходимо тоже опустить страницу вниз сев почитал почитал но есть

нюанс где там наш код почитал данный код работает с первой странице self page его лейт именно

относится к 1 она какой смысл когда мы будем на странице с продавцом если он опустит первую

страницу где есть результат поиска еще раз смысла никакого поэтому нам необходимо чтобы это все

заработал нам необходимо сюда передать страницу с какой именно будем работать page и здесь мы будем

уже вызывать именно page тут которому и передадим к нему все будет относиться и здесь мы тогда

передадим self page 2 но и подправим код вот здесь self page 1 то есть 1 страница вот теперь это все

заработает далее что нам необходимо нам необходимо наверно подождать в ожидании в плейрате работают

не так как в селениум совсем не так силенем вообще абсолютно ничего не ждет он если нет

какого-то элемента или нет текста или чего-то еще нет он просто выдаст ошибку в плейрайте

немного интереснее но и сложнее то есть некоторые элементы он ждет некоторые нет к примеру если вы

хотите кликнуть по элементу он его будет ждать в течение там не помню 50 секунд что такое но

Но если вы просто захотите найти какой-то элемент, ожидания не будет.

Да, может немного усложнено, но в принципе это звучит разумно.

Поэтому нам необходимо дождаться элемента.

Какого элемента мы будем ждать?

Товары по лучшим ценам?

Но явно нет, потому как у каждого продавца слоган будет свой.

Big Sale это название продавца, тоже может везде свое быть.

продавец явно будет давать его и ждать self page 2 фаселектор такой селектор я сегодня уже писал

поэтому не буду повторяться далее что нам необходимо сделать нам нужно найти название

new brave как видите к тайтл мы не можем подвязаться к классу тем более нам остается только подвязаться

к данной ссылке потому как класса выше тоже ну как-то называется не очень давайте наверное

это и сделаем скопируем данную ссылку обратите внимание что данный элемент он не один под

элемент имеет такую же ссылку поэтому имеет смысл нам найти но они находятся в начале страницы

принципе ожидаемо что их всего два может больше мы можем их найти и взять второй из них с него

взять уже текст звучит как хороший план поэтому давайте элемент без фантазии в конце дня поэтому

назовем банально так коври селектор пол но и как написать данный select мы ищем а элемент а у которого

и чрев равно чему-то там но так как мы не знаем полностью так как мы не знаем как будет полностью

выглядеть данная ссылка сал далее seller нам необходимо после и череп поставить вот такой

вот знак это shift 6 он ставится это значит что просто элемент начинается вот с такого значения

что будет дальше нам неважно но и селерным ровным элемент так как элементов будет несколько мы возьмем

первый и возьмем у него атрибут уточнение атрибута достанем inner текст по сути обычный текст который

который есть print выведем на печать но естественно хотелось бы проверить но я не имею сейчас такой

возможности наверно вручную посмотреть кучу ссылок есть подозрение сейчас что не везде будет слово

продавец там может быть примеру написать наверно сам озон тоже иногда продает

товары и он скорее всего напишет что он супер продавец или владелец данного

интернет-магазина что-то типа того поэтому давайте наверное мы обернем это

втро и и если то есть если не найдет данное этот свою ошибку не будем

заморачиваться с конкретной ошибкой просто вернем и продолжим работу вот и все давайте запустим проверим

итак результаты поиска открылись

открыла вторую ссылку с элементом

крыл третью ссылку с элементом

да результат есть только я так подозреваем не везде

написано давайте дождемся уже не в эфне вы код работает просто требуется отладка каких-то ошибок

но скорее всего этой ошибки которые сказал я сейчас не буду заморачиваться с такими ошибками

в принципе нет нужды в этом я хотел вас просто познакомить чуть поближе с плейрайтом и показать

основные методы то есть каким образом можно найти элемент кликнуть по нему ввести данные подождать

какой-то элемент какими разными способами это можно сделать что такое контекст как открыть

новую страницу взять какой-то атрибут у элемента или как взять у него текст рассказал интересную

вещь с numeraid надеюсь будете пользоваться но и конечно хотелось бы уделить плейрайту гораздо

больше времени так как я подозреваю что во многих людей вызывает он большой интерес так как скорее

всего это в будущем будет конкретная замена selenium в данный момент он еще не настолько

распространен потому как многие проекты довольно старые проекты на которых писали тесты уже давно

и собранная огромная база тех же селениум тестов и переходить на какой-то другой какую-то другую

библиотеку не имеет особо большого смысла но и несет в себе определенные риски и проблемы поэтому

новые проекты какие-то которые создаются люди скажем сами вольны выбирать что использовать

да многие начинают смотреть что что выбрать в чем плюс в чем минусы и уже тогда могут склоняться к

playwright на старых проектах что ничего такого нет но все в будущем может измениться библиотека

еще довольно свежие всего пару лет и работает она довольно таки хорошо интересно и очень много

новых функций если вам понравилось данное видео и может быть вы хотите углубиться в плейрайт гораздо

сильнее и скажем так я заодно с вами это сделаю вариант есть такая мысль со временем записать

конкретный курс по плейрайту чисто по плейрайту по всем методам как что здесь делается сами видите

что методов здесь огромное количество и на самом деле надо записывать на каждый метод какую-то ну

пусть на два метода один урок потому как показать как это работает как вообще это выглядит для чего

это из чем его едят подписывайтесь оставляйте комментарии хотите вы увидеть видеокурс по

playwright или нет самое безбашенные могут вообще финансово поддержать данный курс ссылка будет в

описании всем спасибо пока

